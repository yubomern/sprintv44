<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Course Manager</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <style>
    body{font-family:sans-serif;padding:20px;}
    .course-card{border:1px solid #ccc;padding:15px;margin:10px 0;border-radius:8px;}
    .course-card embed{width:100%;height:200px;}
    form{margin-bottom:20px;}
    form input,form textarea{display:block;width:100%;margin-bottom:10px;padding:8px;}

    .centered-container {
        height: 100vh;
    }
    .row .col-md-5 {
        text-align: left;
    }
    .bg-set {
        background: rgb(238, 174, 202);
        background: radial-gradient(circle, rgba(238, 174, 202, 1) 0%, rgba(148, 187, 233, 1) 100%);
    }
    .steps {
        display: flex;
        flex-wrap: wrap;
        justify-content: space-evenly;
    }
  </style>
</head>
<body>
  <h1>Course CRUD with PDF Upload</h1>
  <form id="courseForm">
    <input type="hidden" id="courseId">
    <input type="text" id="title" placeholder="Title" required>
    <textarea id="description" placeholder="Description"></textarea>
    <input type="text" id="category" placeholder="Category" required>
    <input type="text" id="matiere" placeholder="matiere" required>
    <input type="text" id="user_id" placeholder="user_id" required>
    <input type="number" id="price" placeholder="Price" required>
    <input type="file" name="pdf" id="pdfFile" accept="application/pdf">
    <button type="submit">Save Course</button>
  </form>
  <div id="courseList"></div>

<script>
function fetchCourses(){
  $.get('/api/courses', data=>{
    $('#courseList').empty();
    data.forEach(c=>{
      $('#courseList').append(`
        <div class="course-card">
          <h3>${c.title} ($${c.price})</h3>
          <p>${c.description}</p>
          <p>Category: ${c.category}</p>
          <p>user_id: ${c.user_id}</p>
          ${c.pdf?`<embed src="${c.pdf}" type="application/pdf" />`:''}
          <button onclick="editCourse('${c._id}')">Edit</button>
          <button onclick="deleteCourse('${c._id}')">Delete</button>
        </div>
      `);
    });
  });
}
fetchCourses();

$('#courseForm').submit(function(e){
  e.preventDefault();
  const form = new FormData();
  form.append("title", $("#title").val());
  form.append("description", $("#description").val());
  form.append("category", $("#category").val());
  form.append("user_id", $("#user_id").val());
  form.append("matiere", $("#matiere").val());
  
  form.append("price", $("#price").val());
  const file = $("#pdfFile")[0].files[0];
  if(file) form.append("pdf", file);

  const id = $("#courseId").val();
  const opts = {url: id?`/api/courses/${id}`:'/api/courses', method: id?'PUT':'POST', data:form, contentType:false, processData:false,
    success:()=>{fetchCourses(); resetForm();}
  };
  $.ajax(opts);
});

function editCourse(id){
  $.get(`/api/courses/${id}`, c=>{
    $("#courseId").val(c._id);
    $("#title").val(c.title);
    $("#description").val(c.description);
    $("#category").val(c.category);
    $("#price").val(c.price);
    $("#user_id").val(c.user_id);
  });
}
function deleteCourse(id){
  if(confirm("Delete?")) $.ajax({url:`/api/courses/${id}`,method:'DELETE',success:fetchCourses});
}
function resetForm(){
  $("#courseId").val('');
  $("#courseForm")[0].reset();
}
</script>
</body>
</html>
